<chapter xmlns="http://docbook.org/ns/docbook"
         xmlns:xi="http://www.w3.org/2001/XInclude"
         xmlns:xlink="http://www.w3.org/1999/xlink"
         xml:id="anttask" version="5.0">
<title>Calabash Ant Task</title>

<para>This chapter describes how to run <citetitle>XML
Calabash</citetitle> from Apache Ant using the
<code>CalabashTask</code> custom task.</para>

<section xml:id="antsetup">
<title>Setting up the Ant Task and Types</title>

<para>Setting up is as for any other custom Antlib.
       You need a <tag class="emptytag">typedef</tag> and a namespace declaration.
       After that the custom Task and Types are available in the defined namespace.
       If you put the calabash.jar to your Ant classpath, e. g. by placing it inside
       <literal>${ant.home}/lib</literal>, you can even save the
       <tag class="emptytag">typedef</tag> declaration ant the namespace definition
       is enough to invoke the secret magic that automatically loads the Antlib as
       soon as it is used in the build file.</para>

<programlisting><![CDATA[<project xmlns:c="antlib:com.xmlcalabash">
    <typedef uri="antlib:com.xmlcalabash"
             resource="com/xmlcalabash/antlib.xml"
             classpath="]]><replaceable>path/to</replaceable><![CDATA[/calabash.jar"/>
</project>]]></programlisting>
</section>

<section>
<title>Description</title>
<para>Runs Calabash.  You can use this task to process:<itemizedlist>
                                    <listitem>
                                             <para>A single input file to produce a single output
                                                  file</para>
                                    </listitem>
                                    <listitem>
                                             <para>A set of input files, processed one at a time, to
                                                  produce a set of output files</para>
                                    </listitem>
                                    <listitem>
                                             <para>Multiple input files as the input to one XProc
                                                  input port processed to produce a single output
                                                  file</para>
                                    </listitem>
                                    <listitem>
                                             <para>Any of the above with additional input ports to
                                                  each of which are applied one or more input files
                                                  whose file names may be either fixed or mapped
                                                  from the name(s) of the current main input
                                                  file(s)</para>
                                    </listitem>
                                    <listitem>
                                             <para>Any of the above with additional output ports
                                                  whose file names may be either fixed or mapped
                                                  from the name(s) of the current main input
                                                  file(s)</para>
                                    </listitem>
                           </itemizedlist></para>
                  <para>You can also specify options and parameters to be used by the
                           pipeline.</para>
                  <section>
                           <title>Custom Task and Types</title>
                           <para>The previously defined Antlib provides one custom task and four
                                  custom types in the configured namespace.</para>
                           <section>
                                    <title>calabash</title>
                                    <para>The custom Ant Task that is provided by the Antlib.
                                           This is the main piece of the Calabash Ant integration.
                                           The remaining sections of this chapter describe the
                                           usage of this task.</para>
                           </section>
                           <section>
                                    <title>stdin</title>
                                    <para>A read-only Ant Resource that connects to stdin.</para>
                           </section>
                           <section>
                                    <title>stdout</title>
                                    <para>A write-only Ant Resource that connects to stdout.</para>
                           </section>
                           <section>
                                    <title>stdinout</title>
                                    <para>A read-write Ant Resource that connects to stdin
                                           for reading and to stdout for writing.</para>
                           </section>
                           <section>
                                    <title>stderr</title>
                                    <para>A write-only Ant Resource that connects to stderr.</para>
                           </section>
                  </section>
                  <section xml:id="ant.input-and-output">
                           <title>Input and output files and filesets</title>
                           <para>In the simplest scenario, the <tag class="attribute">in</tag>
                                    attribute, if present, specifies the single input file and / or
                                    the <tag class="attribute">out</tag> attribute, if present,
                                    specifies the single output file.  The <tag class="attribute"
                                             >inPort</tag> and <tag class="attribute">outPort</tag>
                                    attributes specify the pipeline port to which to apply the input
                                    or from which to receive the output, respectively, though these
                                    may be omitted as stated below.</para>
                           <para>You can as well or instead specify one or more files to apply to an
                                    input port using one or more nested <tag class="element"
                                             >input</tag> elements.</para>
                           <para><tag class="element">input</tag> elements whose <tag
                                             class="attribute">port</tag> attribute value matches
                                             <tag class="attribute">inPort</tag> (or whose <tag
                                             class="attribute">port</tag> attribute is omitted when
                                             <tag class="attribute">inPort</tag> is omitted) are
                                    applied to the <tag class="attribute">inPort</tag> port.  Those
                                             <tag class="element">input</tag> elements may contain
                                    zero or more <link xlink:href="http://ant.apache.org/manual/Types/resources.html">Ant resources</link>
                                    (i.e., <tag class="element">fileset</tag>, <tag class="element"
                                             >dirset</tag>, etc.).</para>
                           <para><tag class="element">input</tag> elements for ports other than the
                                             <tag class="attribute">inPort</tag> port may contain
                                    either zero or more <link xlink:href="http://ant.apache.org/manual/Types/resources.html">Ant resources</link> or an Ant
                                    mapper element (i.e., <tag class="element">mapper</tag>, <tag
                                             class="element">globmapper</tag>, etc.) that maps the
                                    current <tag class="attribute">inPort</tag> file(s) name(s) to
                                    other file name(s) that are used as the input file(s) for that
                                    port. You cannot specify both Ant resources and a mapper
                                    for an input port (nor can you specify a mapper for the <tag
                                             class="attribute">inPort</tag> port).</para>
                           <para>You can as well or instead specify a file to contain the output of
                                    an output port using one or more nested <tag class="element"
                                             >output</tag> elements. You cannot specify more than
                                    one <tag class="element">output</tag> element for any pipeline
                                    output.</para>
                           <para>An <tag class="element">output</tag> element whose <tag
                                             class="attribute">port</tag> attribute value matches
                                             <tag class="attribute">outPort</tag> (or whose <tag
                                             class="attribute">port</tag> attribute is omitted when
                                             <tag class="attribute">outPort</tag> is omitted) is
                                    used for the <tag class="attribute">outPort</tag> port. This
                                             <tag class="element">output</tag> element and the <tag
                                             class="attribute">out</tag> attribute cannot both be
                                    used at once.</para>
                           <para>Other <tag class="element">output</tag> elements may each be used
                                    for any of the other output ports of the pipeline.</para>
                           <para><tag class="attribute">output</tag> elements may contain either
                                    zero or more <link xlink:href="http://ant.apache.org/manual/Types/resources.html">Ant resources</link> or an Ant mapper
                                    element (i.e., <tag class="element">mapper</tag>, <tag
                                             class="element">globmapper</tag>, etc.) that maps the
                                    current <tag class="attribute">inPort</tag> file(s) name(s) to a
                                    file name that is used as the output file for that port.  You
                                    cannot specify both Ant resources and a mapper for an
                                    output port, and the <tag class="element">output</tag> cannot
                                    result in more than one file name.</para>
                           <para>When no files are specified for either the <tag class="attribute"
                                             >inPort</tag> or <tag class="attribute">outPort</tag>
                                    ports, the implicit fileset (formed based on <tag
                                             class="attribute">includes</tag> and other attributes
                                    of <tag class="element">calabash</tag>) and / or an explicit file
                                    set (formed from nested <link xlink:href="http://ant.apache.org/manual/Types/resources.html">Ant resources</link> (outside of
                                    any <tag class="element">input</tag> or <tag class="element"
                                             >output</tag> elements) makes a set of files that are
                                    processed one at a time as the input to the <tag
                                             class="attribute">inPort</tag> port in separate runs of
                                    the pipeline.</para>
                           <para>The <tag class="attribute">basedir</tag>, <tag class="attribute"
                                             >includes</tag>, <tag class="attribute"
                                             >includesfile</tag>, <tag class="attribute"
                                             >excludes</tag>, <tag class="attribute"
                                             >excludesfile</tag>, <tag class="attribute"
                                             >defaultexcludes</tag>, and <tag class="attribute"
                                             >scanincludeddirectories</tag> attributes determine the
                                    implicit fileset.  <tag class="attribute"
                                             >useimplicitfileset</tag> can disable the implicit
                                    fileset.</para>
                           <para>When the implicit fileset and / or the explicit fileset selects one
                                    or more files, the <tag class="attribute">destdir</tag>, and
                                             <tag class="attribute">extension</tag> attributes (or
                                    using a nested mapper instead of <tag class="attribute"
                                             >extension</tag>) determine the filename to use for the
                                    output of the <tag class="attribute">outPort</tag> port, and the
                                    <link xlink:href="http://ant.apache.org/manual/Types/resources.html">Ant resources</link>
                                    or mapper for other input and output ports
                                    determine the file(s) from which to read or the file to which to
                                    write for those ports.</para>
                  </section>
                  <section>
                           <title>Ports</title>
                           <para>The <tag class="attribute">inPort</tag> and <tag class="attribute"
                                             >outPort</tag> attributes determine the pipeline ports
                                    to use for single, or sequential, processing of files.
                                    Additionally, the filename of the file on the <tag
                                             class="attribute">inPort</tag> port is used (or can be
                                    used) by mappers to determine the input or output files to use
                                    for other ports.</para>
                           <para>You may omit at most one input port name and at most one output
                                    port name from the ports specified on the <tag class="element"
                                             >calabash</tag> task. The <tag class="element"
                                             >calabash</tag> task maps the primary non-parameter
                                    input the primary output port of the pipeline to the
                                    unnamed ports (and any additional port without a defined mapping
                                    will cause an error). The omitted ports do not have to be the
                                             <tag class="attribute">inPort</tag> and <tag
                                             class="attribute">outPort</tag> ports; e.g., you can
                                    instead specify <tag class="attribute">inPort</tag> and omit the
                                             <tag class="attribute">port</tag> attribute on the
                                    nested <tag class="element">input</tag> element for a different
                                    port.</para>
                           <para>Nested <tag class="element">parameter</tag> elements specify Inputs
                                    to parameter ports.</para>
                  </section>
</section>

<section>
<title>Parameters</title>
                  <informaltable frame="border">
                           <thead>
                                    <tr>
                                             <th>Attribute</th>
                                             <th>Description</th>
                                             <th>Required</th>
                                    </tr>
                           </thead>
                           <tbody>
                                    <tr>
                                             <td>in</td>
                                             <td>Path to a single file to process as main input</td>
                                             <td>No</td>
                                    </tr>
                                    <tr>
                                             <td>inType</td>
                                             <td>The input type that is used for <tag class="attribute">in</tag> file or for implicit
                                                  or explicit filesets, either <literal>XML</literal> or <literal>DATA</literal></td>
                                             <td>No; default is <literal>XML</literal></td>
                                    </tr>
                                    <tr>
                                             <td>inPort</td>
                                             <td>Pipeline input port to which to apply
                                                      <tag class="attribute">in</tag> file (or to apply files from
                                                  implicit or explicit filesets)</td>
                                             <td>No; the primary non-parameter input port will be used</td>
                                    </tr>
                                    <tr>
                                             <td>out</td>
                                             <td>Path to the single output result file that will be produced</td>
                                             <td>No</td>
                                    </tr>
                                    <tr>
                                             <td>outPort</td>
                                             <td>Pipeline output port that writes to out (or to
                                                  outputs mapped from implicit and / or explicit input
                                                  filesets)</td>
                                             <td>No; the primary output port will be used</td>
                                    </tr>
                                    <tr>
                                             <td>pipeline</td>
                                             <td>Path to a single XProc pipeline file to be used</td>
                                             <td>Yes, unless a nested <tag class="element">pipeline</tag> has
                                                  been specified, or unless nested <tag class="element">library</tag>
                                                  or <tag class="element">step</tag> elements have been specified in which
                                                  case no pipeline must be specified explicitly</td>
                                    </tr>
                                    <tr>
                                             <td>useImplicitFileset</td>
                                             <td>Whether to use the implicit fileset formed using
                                                  includes, excludes, etc.</td>
                                             <td>No; default is <literal>true</literal> unless
                                                      <tag class="attribute">in</tag> or a nested
                                                  <tag class="element">input</tag> corresponding to
                                                      <markup>inPort</markup> or <tag class="attribute">out</tag> or
                                                  a nested <tag class="element">output</tag> corresponding to
                                                  <markup>outPort</markup> has been specified</td>
                                    </tr>
                                    <tr>
                                             <td>basedir</td>
                                             <td>Where to find the source XML when the implicit
                                                  fileset or input mappers are used</td>
                                             <td>No; default is the Ant project's
                                                  <tag class="attriute">basedir</tag></td>
                                    </tr>
                                    <tr>
                                             <td>destdir</td>
                                             <td>Where to store the results when the implicit
                                                  fileset or output mappers are used</td>
                                             <td>No; default is the <tag class="attriute">basedir</tag></td>
                                    </tr>
                                    <tr>
                                             <td>extension</td>
                                             <td>Desired file extension to use for outputs mapped
                                                  from the implicit and / or explicit filesets</td>
                                             <td>No; default is <literal>-out.xml</literal></td>
                                    </tr>
                                    <tr>
                                             <td>includes</td>
                                             <td>Comma- or space-separated list of patterns of files
                                                  that must be included. All files are included when
                                                  omitted. </td>
                                             <td>No</td>
                                    </tr>
                                    <tr>
                                             <td>includesfile</td>
                                             <td>Name of a file, each line of which is taken as an
                                                  include pattern</td>
                                             <td>No</td>
                                    </tr>
                                    <tr>
                                             <td>excludes</td>
                                             <td>Comma- or space-separated list of patterns of files
                                                  that must be excluded. No files (except default
                                                  excludes) are excluded when omtted.</td>
                                             <td>No</td>
                                    </tr>
                                    <tr>
                                             <td>excludesfile</td>
                                             <td>Name of a file, each line of which is taken as an
                                                  exclude pattern</td>
                                             <td>No</td>
                                    </tr>
                                    <tr>
                                             <td>defaultexcludes</td>
                                             <td>Indicates whether default excludes should be used
                                                  or not. Default excludes are used when
                                                  omitted.</td>
                                             <td>No; default is <literal>true</literal></td>
                                    </tr>
                                    <tr>
                                             <td>scanIncludedDirectories</td>
                                             <td>If any directories are matched by the
                                                  includes / excludes patterns, try to process all
                                                  files in those directories</td>
                                             <td>No; default is <literal>true</literal></td>
                                    </tr>
                                    <tr>
                                             <td>failOnNoResources</td>
                                             <td>Whether the build should fail if the explicit
                                                  fileset from nested <link xlink:href="http://ant.apache.org/manual/Types/resources.html">Ant resources</link> is
                                                  empty</td>
                                             <td>No; default is <literal>true</literal></td>
                                    </tr>
                                    <tr>
                                             <td>force</td>
                                             <td>Run pipeline, even when outputs are newer than
                                                  all inputs and the pipeline.</td>
                                             <td>No; default is <literal>false</literal></td>
                                    </tr>
                                    <tr>
                                             <td>failOnError</td>
                                             <td>Whether the build should fail if any errors
                                                  occur</td>
                                             <td>No; default is <literal>true</literal></td>
                                    </tr>
                                    <tr>
                                             <td>debug</td>
                                             <td>Whether to enable debugging output from
                                                  Calabash</td>
                                             <td>No; default is <literal>false</literal></td>
                                    </tr>
                                    <tr>
                                             <td>generalValues</td>
                                             <td>Whether to enable general values.  See <uri
                                                  xlink:href="extensions.html#ext.general-values"
                                                  >http://xmlcalabash.com/docs/reference/extensions.html#ext.general-values</uri></td>
                                             <td>No; default is <literal>false</literal></td>
                                    </tr>
                                    <tr>
                                             <td>xPointerOnText</td>
                                             <td>Whether XPointer attributes on an XInclude element
                                                  can be used when
                                                  <markup>parse="text"</markup></td>
                                             <td>No; default is <literal>false</literal></td>
                                    </tr>
                                    <tr>
                                             <td>useXslt10</td>
                                             <td>Whether to enable the use of XSLT 1.0</td>
                                             <td>No; default is <literal>false</literal></td>
                                    </tr>
                                    <tr>
                                             <td>transparentJSON</td>
                                             <td>Whether ot automatically translate between JSON and
                                                  XML</td>
                                             <td>No; default is <literal>false</literal></td>
                                    </tr>
                                    <tr>
                                             <td>jsonFlavor</td>
                                             <td>Desired JSON flavor</td>
                                             <td>No</td>
                                    </tr>
                                    <tr>
                                             <td>profileFile</td>
                                             <td>The path to the file where profile information should be written to, or "<literal>-</literal>" for stdout</td>
                                             <td>No</td>
                                    </tr>
                                    <tr>
                                             <td>saxonProcessor</td>
                                             <td>The edition of Saxon that should be used, must be "<literal>he</literal>" (default), "<literal>pe</literal>" or "<literal>ee</literal>"</td>
                                             <td>No; default is "<literal>he</literal>"</td>
                                    </tr>
                                    <tr>
                                             <td>saxonConfigFile</td>
                                             <td>The path to the Saxon configuration file to be loaded</td>
                                             <td>No</td>
                                    </tr>
                                    <tr>
                                             <td>schemaAware</td>
                                             <td>Whether schema-aware processing should be done</td>
                                             <td>No; default is <literal>false</literal></td>
                                    </tr>
                                    <tr>
                                             <td>safeMode</td>
                                             <td>Whether "safe" execution should be done</td>
                                             <td>No; default is <literal>false</literal></td>
                                    </tr>
                                    <tr>
                                             <td>configFile</td>
                                             <td>The path to a particular configuration file to be loaded</td>
                                             <td>No</td>
                                    </tr>
                                    <tr>
                                             <td>logStyle</td>
                                             <td>The default style for p:log output, must be "<literal>off</literal>", "<literal>plain</literal>", "<literal>wrapped</literal>" (default), or "<literal>directory</literal>"</td>
                                             <td>No; default is "<literal>wrapped</literal>"</td>
                                    </tr>
                                    <tr>
                                             <td>entityResolver</td>
                                             <td>The resolver class for entity resolution</td>
                                             <td>No</td>
                                    </tr>
                                    <tr>
                                             <td>uriResolver</td>
                                             <td>The resolver class for URI resolution</td>
                                             <td>No</td>
                                    </tr>
                           </tbody>
                  </informaltable>
</section>
         <section>
                  <title>Parameters specified as nested elements</title>
                  <section xml:id="ant.input">
                           <title>input</title>
                           <para>Specification of resources to apply to an input port. May specify
                                    additional or alternative inputs to be applied to the
                                    <tag class="attribute">inPort</tag> port or may be fixed or mapped
                                    resources to be applied to other ports.</para>
                           <section>
                                    <title>Parameters</title>
                                    <informaltable frame="border">
                                             <thead>
                                                      <tr>
                                                               <th>Attribute</th>
                                                               <th>Description</th>
                                                               <th>Required</th>
                                                      </tr>
                                             </thead>
                                             <tbody>
                                                      <tr>
                                                               <td>port</td>
                                                               <td>port name</td>
                                                               <td>No; the primary non-parameter input
                                                                        port will be used</td>
                                                      </tr>
                                                      <tr>
                                                               <td>type</td>
                                                               <td>input type, either <literal>XML</literal> or <literal>DATA</literal></td>
                                                               <td>No; default is <literal>XML</literal></td>
                                                      </tr>
                                                      <tr>
                                                               <td>contentType</td>
                                                               <td>content type, if this is equal to <literal>application/xml</literal>,
                                                                        ends in <literal>+xml</literal>, starts with <literal>text/</literal>
                                                                        or has a charset of <literal>utf-8</literal> specified, the input
                                                                        is treated as text, otherwise the input gets base64 encoded
                                                                        automatically before it is given to the pipeline</td>
                                                               <td>No; default is guessed from the resource content, as fallback from the
                                                                        resource name and as second fallback <literal>application/octet-stream</literal>
                                                                        is used</td>
                                                      </tr>
                                                      <tr>
                                                               <td>if</td>
                                                               <td>This parameter behaves like standard Ant if's as documented at
                                                                        <uri>http://ant.apache.org/manual/properties.html#if+unless</uri></td>
                                                               <td>No</td>
                                                      </tr>
                                                      <tr>
                                                               <td>unless</td>
                                                               <td>This parameter behaves like standard Ant unless' as documented at
                                                                        <uri>http://ant.apache.org/manual/properties.html#if+unless</uri></td>
                                                               <td>No</td>
                                                      </tr>
                                             </tbody>
                                    </informaltable></section>
                           <section>
                                    <title>Parameters specified as nested elements</title>
                                    <para>Either <link xlink:href="http://ant.apache.org/manual/Types/resources.html">Ant resources</link> <emphasis>or</emphasis> a
                                             mapper may be specified, but not both.</para>
                                    <section>
                                             <title>any <link xlink:href="http://ant.apache.org/manual/Types/resources.html">Ant resource</link></title>
                                             <para>Use <link xlink:href="http://ant.apache.org/manual/Types/resources.html">Ant resources</link> to specify
                                                      fixed resources that should be applied to this
                                                      port. Any readable resource can be used, e. g.
<programlisting><![CDATA[<input>
    <string><![CDATA[
        <foo/>
    ]]]]><![CDATA[></string>
</input>]]></programlisting>
                                                  or
<programlisting><![CDATA[<input>
    <url url="http://www.w3.org"/>
</input>]]></programlisting></para>
                                    </section>
                                    <section>
                                             <title>mapper</title>
                                             <para>You can define resources to be used based on the
                                                  resource(s) specified for the <tag
                                                  class="attribute">inPort</tag> port or on the
                                                  current resource from the implicit and / or explicit
                                                  input fileset.</para>
                                             <para>You cannot use a mapper on the <tag class="attribute">inPort</tag> port.</para>
                                    </section>
                           </section>

                  </section>
                  <section xml:id="ant.pipeline">
                           <title>pipeline</title>
                           <para>Pipeline resource. Can be used instead of <tag class="attribute"
                                             >pipeline</tag> attribute.</para>
                           <section>
                                    <title>Parameters</title>
                                    <informaltable frame="border">
                                             <thead>
                                                      <tr>
                                                               <th>Attribute</th>
                                                               <th>Description</th>
                                                               <th>Required</th>
                                                      </tr>
                                             </thead>
                                             <tbody>
                                                      <tr>
                                                               <td>if</td>
                                                               <td>This parameter behaves like standard Ant if's as documented at
                                                                        <uri>http://ant.apache.org/manual/properties.html#if+unless</uri></td>
                                                               <td>No</td>
                                                      </tr>
                                                      <tr>
                                                               <td>unless</td>
                                                               <td>This parameter behaves like standard Ant unless' as documented at
                                                                        <uri>http://ant.apache.org/manual/properties.html#if+unless</uri></td>
                                                               <td>No</td>
                                                      </tr>
                                             </tbody>
                                    </informaltable>
                           </section>
                           <section>
                                    <title>Parameters specified as nested elements</title>
                                    <section>
                                             <title>any <link xlink:href="http://ant.apache.org/manual/Types/resources.html">Ant resource</link></title>
                                             <para>Any <link xlink:href="http://ant.apache.org/manual/Types/resources.html">Ant resource</link> can be used, but only
                                                  one single readable resource may be contained
                                                  in it, e. g.
<programlisting><![CDATA[<pipeline>
    <string><![CDATA[
        <p:declare-step xmlns:p="http://www.w3.org/ns/xproc" version="1.0">
            <p:input port="source" kind="document" primary="true"/>
            <p:output port="result" sequence="true"/>
            <p:identity/>
        </p:declare-step>
    ]]]]><![CDATA[></string>
</pipeline>]]></programlisting>
                                                  or
<programlisting><![CDATA[<pipeline>
    <url url="http://www.domain.org/pipeline.xpl"/>
</pipeline>]]></programlisting></para>
                                    </section>
                           </section>
                  </section>
                  <section xml:id="ant.output">
                           <title>output</title>
                           <para>Specification of resources to which to write the output from an
                                    output port. May be used as an alternative to <tag
                                             class="attribute">out</tag> to specify to where to
                                    write the output from the <tag class="attribute">outPort</tag>
                                    port or may be fixed or mapped resources to be applied to other
                                    ports.</para>
                           <section>
                                    <title>Parameters</title>
                                    <informaltable frame="border">
                                             <thead>
                                                  <tr>
                                                  <th>Attribute</th>
                                                  <th>Description</th>
                                                  <th>Required</th>
                                                  </tr>
                                             </thead>
                                             <tbody>
                                                  <tr>
                                                           <td>port</td>
                                                           <td>port name</td>
                                                           <td>No; the primary output port will be used</td>
                                                  </tr>
                                                  <tr>
                                                           <td>if</td>
                                                           <td>This parameter behaves like standard Ant if's as documented at
                                                                    <uri>http://ant.apache.org/manual/properties.html#if+unless</uri></td>
                                                           <td>No</td>
                                                  </tr>
                                                  <tr>
                                                           <td>unless</td>
                                                           <td>This parameter behaves like standard Ant unless' as documented at
                                                                    <uri>http://ant.apache.org/manual/properties.html#if+unless</uri></td>
                                                           <td>No</td>
                                                  </tr>
                                             </tbody>
                                    </informaltable>
                           </section>
                           <section>
                                    <title>Parameters specified as nested elements</title>
                                    <para>Either <link xlink:href="http://ant.apache.org/manual/Types/resources.html">Ant resources</link>
                                             <emphasis>or</emphasis> a mapper may be specified, but not both.</para>
                                    <section>
                                             <title>any <link xlink:href="http://ant.apache.org/manual/Types/resources.html">Ant resource</link></title>
                                             <para>Use <link xlink:href="http://ant.apache.org/manual/Types/resources.html">Ant resources</link> to specify fixed
                                                  resources that should be applied to this
                                                  port. Any writable <link xlink:href="http://ant.apache.org/manual/Types/resources.html">Ant resource</link> can be used, e. g.
<programlisting><![CDATA[<output>
    <bzip2resource>
        <file file="result.xml.bz2"/>
    </bzip2resource>
</output>]]></programlisting></para>
                                    </section>
                                    <section>
                                             <title>mapper</title>
                                             <para>You can define resources to which to write based
                                                  on the resource(s) specified for the <tag
                                                  class="attribute">inPort</tag> port.</para>
                                    </section>
                           </section>
                  </section>
                  <section>
                           <title>any <link xlink:href="http://ant.apache.org/manual/Types/resources.html">Ant resource</link></title>
                           <para>Use readable <link xlink:href="http://ant.apache.org/manual/Types/resources.html">Ant resources</link> to specify fixed resources that
                           should be processed consecutively in a sequence of Calabash
                           runs.</para>
                  </section>
                  <section>
                           <title>mapper</title>
                           <para>You can define resources to which to write based on the
                           resource(s) specified for the implicit fileset (based on <tag
                                    class="attribute">includes</tag>, etc.) and / or on the
                           explicit fileset formed from resource collections that are
                           children of <tag class="element">calabash</tag>.</para>
                  </section>
                  <section>
                           <title>namespace</title>
                           <para>Use nested <tag class="element">namespace</tag> elements to define
                                    mappings between prefixes and namespace URIs for any prefixes
                                    that are used in <tag class="element">option</tag> or <tag
                                             class="element">parameter</tag> elements.</para>
                           <section>
                                    <title>Parameters</title>
                                    <informaltable frame="border">
                                             <thead>
                                                      <tr>
                                                               <th>Attribute</th>
                                                               <th>Description</th>
                                                               <th>Required</th>
                                                      </tr>
                                             </thead>
                                             <tbody>
                                                      <tr>
                                                               <td>prefix</td>
                                                               <td>Prefix to which to map the URI</td>
                                                               <td>Yes</td>
                                                      </tr>
                                                      <tr>
                                                               <td>uri</td>
                                                               <td>Namespace uri</td>
                                                               <td>Yes</td>
                                                      </tr>
                                                      <tr>
                                                               <td>if</td>
                                                               <td>This parameter behaves like standard Ant if's as documented at
                                                                        <uri>http://ant.apache.org/manual/properties.html#if+unless</uri></td>
                                                               <td>No</td>
                                                      </tr>
                                                      <tr>
                                                               <td>unless</td>
                                                               <td>This parameter behaves like standard Ant unless' as documented at
                                                                        <uri>http://ant.apache.org/manual/properties.html#if+unless</uri></td>
                                                               <td>No</td>
                                                      </tr>
                                             </tbody>
                                    </informaltable>
                           </section>
                  </section>
                  <section xml:id="ant.option">
                           <title>option</title>
                           <para>Specifies an option to be passed to the XProc processor</para>
                           <section>
                                    <title>Parameters</title>
                                    <informaltable frame="border">
                                             <thead>
                                                      <tr>
                                                               <th>Attribute</th>
                                                               <th>Description</th>
                                                               <th>Required</th>
                                                      </tr>
                                             </thead>
                                             <tbody>
                                                      <tr>
                                                               <td>name</td>
                                                               <td>Option name, which must be
                                                  unique amongst the ones that are going to be used
                                                  according to their <tag class="attriute">if</tag> and
                                                  <tag class="attribute">unless</tag> attributes.
                                                  QNames have their prefix matched against
                                                  bindings specified in <tag class="element"
                                                  >namespace</tag> elements. QNames may also be
                                                  specified in Clark notation, i. e.
                                                  <literal>{uri}name</literal>.</td>
                                                               <td>No</td>
                                                      </tr>
                                                      <tr>
                                                               <td>value</td>
                                                               <td>Option string value</td>
                                                               <td>No</td>
                                                      </tr>
                                                      <tr>
                                                               <td>if</td>
                                                               <td>This parameter behaves like standard Ant if's as documented at
                                                                        <uri>http://ant.apache.org/manual/properties.html#if+unless</uri></td>
                                                               <td>No</td>
                                                      </tr>
                                                      <tr>
                                                               <td>unless</td>
                                                               <td>This parameter behaves like standard Ant unless' as documented at
                                                                        <uri>http://ant.apache.org/manual/properties.html#if+unless</uri></td>
                                                               <td>No</td>
                                                      </tr>
                                             </tbody>
                                    </informaltable>
                           </section>
                  </section>
                  <section xml:id="ant.parameter">
                           <title>parameter</title>
                           <para>Specifies a parameter to be passed to the XProc processor</para>
                           <section>
                                    <title>Parameters</title>
                                    <informaltable frame="border">
                                             <thead>
                                                      <tr>
                                                               <th>Attribute</th>
                                                               <th>Description</th>
                                                               <th>Required</th>
                                                      </tr>
                                             </thead>
                                             <tbody>
                                                      <tr>
                                                               <td>port</td>
                                                               <td>Port to which to apply the
                                                  parameter.</td>
                                                               <td>No; default is only available parameter port, if there
                                                                        are no or more than one parameter ports, an error
                                                                        is raised</td>
                                                      </tr>
                                                      <tr>
                                                               <td>name</td>
                                                               <td>Parameter name, which must
                                                  be unique amongst the ones that are going to be used
                                                  according to their <tag class="attriute">if</tag> and
                                                  <tag class="attribute">unless</tag> attributes.
                                                  QNames have their prefix matched
                                                  against bindings specified in <tag class="element"
                                                  >namespace</tag> elements. QNames may also be
                                                  specified in Clark notation, e.g.,
                                                  <literal>{uri}name</literal>.</td>
                                                               <td>No</td>
                                                      </tr>
                                                      <tr>
                                                               <td>value</td>
                                                               <td>Parameter string value</td>
                                                               <td>No</td>
                                                      </tr>
                                                      <tr>
                                                               <td>if</td>
                                                               <td>This parameter behaves like standard Ant if's as documented at
                                                                        <uri>http://ant.apache.org/manual/properties.html#if+unless</uri></td>
                                                               <td>No</td>
                                                      </tr>
                                                      <tr>
                                                               <td>unless</td>
                                                               <td>This parameter behaves like standard Ant unless' as documented at
                                                                        <uri>http://ant.apache.org/manual/properties.html#if+unless</uri></td>
                                                               <td>No</td>
                                                      </tr>
                                             </tbody>
                                    </informaltable>
                           </section>
                  </section>
                  <section><title>sysproperty</title>
                           <para>Specify Java system properties used by Calabash</para></section>
                  <section><title>syspropertyset</title>
                           <para>Specify sets of Java system properties used by Calabash</para></section>
                  <section>
                           <title>profile</title>
                           <para>Profile resource. Can be used instead of <tag class="attribute"
                                             >profileFile</tag> attribute.</para>
                           <section>
                                    <title>Parameters</title>
                                    <informaltable frame="border">
                                             <thead>
                                                      <tr>
                                                               <th>Attribute</th>
                                                               <th>Description</th>
                                                               <th>Required</th>
                                                      </tr>
                                             </thead>
                                             <tbody>
                                                      <tr>
                                                               <td>if</td>
                                                               <td>This parameter behaves like standard Ant if's as documented at
                                                                        <uri>http://ant.apache.org/manual/properties.html#if+unless</uri></td>
                                                               <td>No</td>
                                                      </tr>
                                                      <tr>
                                                               <td>unless</td>
                                                               <td>This parameter behaves like standard Ant unless' as documented at
                                                                        <uri>http://ant.apache.org/manual/properties.html#if+unless</uri></td>
                                                               <td>No</td>
                                                      </tr>
                                             </tbody>
                                    </informaltable>
                           </section>
                           <section>
                                    <title>Parameters specified as nested elements</title>
                                    <section>
                                             <title>any <link xlink:href="http://ant.apache.org/manual/Types/resources.html">Ant resource</link></title>
                                             <para>Any <link xlink:href="http://ant.apache.org/manual/Types/resources.html">Ant resource</link> can be used, but only
                                                  one single writable resource may be contained
                                                  in it, e. g.
<programlisting><![CDATA[<profile>
    <bzip2resource>
        <file file="profile.xml.bz2"/>
    </bzip2resource>
</profile>]]></programlisting>
                                                  or
<programlisting><![CDATA[<profile>
    <stderr/>
</profile>]]></programlisting></para>
                                    </section>
                           </section>
                  </section>
                  <section>
                           <title>saxonConfig</title>
                           <para>Saxon config resource. Can be used instead of <tag class="attribute"
                                             >saxonConfigFile</tag> attribute.</para>
                           <section>
                                    <title>Parameters</title>
                                    <informaltable frame="border">
                                             <thead>
                                                      <tr>
                                                               <th>Attribute</th>
                                                               <th>Description</th>
                                                               <th>Required</th>
                                                      </tr>
                                             </thead>
                                             <tbody>
                                                      <tr>
                                                               <td>if</td>
                                                               <td>This parameter behaves like standard Ant if's as documented at
                                                                        <uri>http://ant.apache.org/manual/properties.html#if+unless</uri></td>
                                                               <td>No</td>
                                                      </tr>
                                                      <tr>
                                                               <td>unless</td>
                                                               <td>This parameter behaves like standard Ant unless' as documented at
                                                                        <uri>http://ant.apache.org/manual/properties.html#if+unless</uri></td>
                                                               <td>No</td>
                                                      </tr>
                                             </tbody>
                                    </informaltable>
                           </section>
                           <section>
                                    <title>Parameters specified as nested elements</title>
                                    <section>
                                             <title>any <link xlink:href="http://ant.apache.org/manual/Types/resources.html">Ant resource</link></title>
                                             <para>Any <link xlink:href="http://ant.apache.org/manual/Types/resources.html">Ant resource</link> can be used, but only
                                                  one single readable resource may be contained
                                                  in it, e. g.
<programlisting><![CDATA[<saxonConfig>
    <bzip2resource>
        <file file="saxon-config.xml.bz2"/>
    </bzip2resource>
</saxonConfig>]]></programlisting>
                                                  or
<programlisting><![CDATA[<saxonConfig>
    <stdin/>
</saxonConfig>]]></programlisting>
                                                  or
<programlisting><![CDATA[<saxonConfig>
    <string><![CDATA[
        <configuration xmlns="http://saxon.sf.net/ns/configuration">
            <global optimizationLevel="10"/>
        </configuration>
    ]]]]><![CDATA[></string>
</saxonConfig>]]></programlisting></para>
                                    </section>
                           </section>
                  </section>
                  <section>
                           <title>config</title>
                           <para>Config resource. Can be used instead of <tag class="attribute"
                                             >configFile</tag> attribute.</para>
                           <section>
                                    <title>Parameters</title>
                                    <informaltable frame="border">
                                             <thead>
                                                      <tr>
                                                               <th>Attribute</th>
                                                               <th>Description</th>
                                                               <th>Required</th>
                                                      </tr>
                                             </thead>
                                             <tbody>
                                                      <tr>
                                                               <td>if</td>
                                                               <td>This parameter behaves like standard Ant if's as documented at
                                                                        <uri>http://ant.apache.org/manual/properties.html#if+unless</uri></td>
                                                               <td>No</td>
                                                      </tr>
                                                      <tr>
                                                               <td>unless</td>
                                                               <td>This parameter behaves like standard Ant unless' as documented at
                                                                        <uri>http://ant.apache.org/manual/properties.html#if+unless</uri></td>
                                                               <td>No</td>
                                                      </tr>
                                             </tbody>
                                    </informaltable>
                           </section>
                           <section>
                                    <title>Parameters specified as nested elements</title>
                                    <section>
                                             <title>any <link xlink:href="http://ant.apache.org/manual/Types/resources.html">Ant resource</link></title>
                                             <para>Any <link xlink:href="http://ant.apache.org/manual/Types/resources.html">Ant resource</link> can be used, but only
                                                  one single readable resource may be contained
                                                  in it, e. g.
<programlisting><![CDATA[<config>
    <bzip2resource>
        <file file="config.xml.bz2"/>
    </bzip2resource>
</config>]]></programlisting>
                                                  or
<programlisting><![CDATA[<config>
    <stdinout/>
</config>]]></programlisting>
                                                  or
<programlisting><![CDATA[<config>
    <string><![CDATA[
        <xproc-config xmlns="http://xmlcalabash.com/ns/configuration">
            <html-parser value="tagsoup" />
        </xproc-config>
    ]]]]><![CDATA[></string>
</config>]]></programlisting></para>
                                    </section>
                           </section>
                  </section>
                  <section xml:id="ant.library">
                           <title>library</title>
                           <para>Library resources. The steps in the libraries loaded are only available in <tag class="emptytag">step</tag> tags.
                                  If no steps are specified, the first step of the first loaded library will be used.</para>
                           <section>
                                    <title>Parameters</title>
                                    <informaltable frame="border">
                                             <thead>
                                                      <tr>
                                                               <th>Attribute</th>
                                                               <th>Description</th>
                                                               <th>Required</th>
                                                      </tr>
                                             </thead>
                                             <tbody>
                                                      <tr>
                                                               <td>if</td>
                                                               <td>This parameter behaves like standard Ant if's as documented at
                                                                        <uri>http://ant.apache.org/manual/properties.html#if+unless</uri></td>
                                                               <td>No</td>
                                                      </tr>
                                                      <tr>
                                                               <td>unless</td>
                                                               <td>This parameter behaves like standard Ant unless' as documented at
                                                                        <uri>http://ant.apache.org/manual/properties.html#if+unless</uri></td>
                                                               <td>No</td>
                                                      </tr>
                                             </tbody>
                                    </informaltable>
                           </section>
                           <section>
                                    <title>Parameters specified as nested elements</title>
                                    <section>
                                             <title>any <link xlink:href="http://ant.apache.org/manual/Types/resources.html">Ant resources</link></title>
                                             <para>Any readable <link xlink:href="http://ant.apache.org/manual/Types/resources.html">Ant resource</link> can be used, e. g.
<programlisting><![CDATA[<library>
    <url url="http://xmlcalabash.com/extension/steps/library-1.0.xpl"/>
</library>]]></programlisting></para>
                                    </section>
                           </section>
                  </section>
                  <section xml:id="ant.step">
                           <title>step</title>
                           <para>The steps to be used to form an implicit pipeline.
                                  If no steps are specified, the first step of the first loaded library will be used.</para>
                           <section>
                                    <title>Parameters</title>
                                    <informaltable frame="border">
                                             <thead>
                                                      <tr>
                                                               <th>Attribute</th>
                                                               <th>Description</th>
                                                               <th>Required</th>
                                                      </tr>
                                             </thead>
                                             <tbody>
                                                      <tr>
                                                               <td>name</td>
                                                               <td>The name of the step to execute.
                                                  QNames have their prefix matched
                                                  against bindings specified in <tag class="element"
                                                  >namespace</tag> elements. QNames may also be
                                                  specified in Clark notation, e.g.,
                                                  <literal>{uri}name</literal>.</td>
                                                               <td>Yes</td>
                                                      </tr>
                                                      <tr>
                                                               <td>if</td>
                                                               <td>This parameter behaves like standard Ant if's as documented at
                                                                        <uri>http://ant.apache.org/manual/properties.html#if+unless</uri></td>
                                                               <td>No</td>
                                                      </tr>
                                                      <tr>
                                                               <td>unless</td>
                                                               <td>This parameter behaves like standard Ant unless' as documented at
                                                                        <uri>http://ant.apache.org/manual/properties.html#if+unless</uri></td>
                                                               <td>No</td>
                                                      </tr>
                                             </tbody>
                                    </informaltable>
                           </section>
                           <section>
                                    <title>Parameters specified as nested elements</title>
                                    <section>
                                             <title>input</title>
					     <para>Input elements as documented in <xref linkend="ant.input"/>, with the exception that no nested mapper is supported, but only resource collections, e. g.
<programlisting><![CDATA[<step name="p:identity">
    <input port="source">
        <string><![CDATA[<foo/>]]]]><![CDATA[></string>
    </input>
</step>]]></programlisting></para>
                                    </section>
                                    <section>
                                             <title>parameter</title>
                                             <para>Parameter elements as documented in <xref linkend="ant.parameter"/>, e. g.
<programlisting><![CDATA[<step name="p:template">
    <parameter name="foo" value="bar" />
</step>]]></programlisting></para>
                                    </section>
                                    <section>
                                             <title>option</title>
                                             <para>Option elements as documented in <xref linkend="ant.option"/>, e. g.
<programlisting><![CDATA[<step name="p:count">
    <option name="limit" value="1" />
</step>]]></programlisting></para>
                                    </section>
                           </section>
                  </section>
         </section>
         <section>
                  <title>Examples</title>
                  <section>
                           <title>Single input, single output</title>
                           <programlisting>&lt;calabash in="in.xml" out="out1.xml" pipeline="pipeline.xpl"/></programlisting>
                           <para>What could be simpler?</para>
                  </section>
                  <section>
                           <title><tag class="element">pipeline</tag></title>
<programlisting><![CDATA[<calabash in="in.xml" out="out.xml">
    <pipeline>
        <file file="pipeline.xpl" />
    </pipeline>
</calabash>]]></programlisting>
                  </section>
                  <section>
                           <title>Implicit fileset plus mapper on additional input port</title>
<programlisting><![CDATA[<calabash includes="doc.xml"
          inPort="source"
          destdir="out"
          extension=".compare.xml"
          pipeline="compare-001.xpl">
    <input port="alternate">
        <globmapper from="*.xml" to="*-alt.xml" />
    </input>
</calabash>]]></programlisting>
                  </section>
                  <section>
                           <title>Fixed input, multiple mapped outputs</title>
<programlisting><![CDATA[<calabash in="group-003_input1.xml" pipeline="group-003_pipeline.xpl">
    <output port="result">
        <globmapper from="*_input1.xml" to="out/*_result.xml" />
    </output>
    <output port="result2">
        <globmapper from="*_input1.xml" to="out/*_result2.xml" />
    </output>
</calabash>]]></programlisting>
                  </section>
                  <section>
                           <title>QNames</title>
<programlisting><![CDATA[<calabash in="in.xml" out="out.xml" pipeline="pipeline.xpl">
    <namespace prefix="hi" uri="low" />
    <parameter name="{hi}there" value="a value" />
    <parameter name="hi:there" value="a value" />
</calabash>]]></programlisting>
                           <para><literal>{hi}there</literal> is a QName in Clark notation, where
                                             <literal>hi</literal> is the namespace URI and
                                             <literal>there</literal> is the local name; whereas
                                             <literal>hi</literal> in <literal>hi:there</literal> is
                                    a namespace prefix that is bound to the <literal>low</literal>
                                    namespace URI.</para>
                  </section>
         </section>
         <section>
                  <title>What not to do</title>
                  <variablelist>
                           <varlistentry>
                                    <term>Multiple pipelines</term>
                                    <listitem>
                                             <para>Too conflicted</para>
                                    </listitem>
                           </varlistentry>
                           <varlistentry>
                                    <term>Non-existent file for <tag class="attribute">in</tag> or
                                                  <tag class="attribute">pipeline</tag> (or <tag
                                                  class="element">pipeline</tag>)</term>
                                    <listitem>
                                             <para>When there's only one of each, it's a problem if
                                                  they don't actually exist</para>
                                    </listitem>
                           </varlistentry>
                           <varlistentry>
                                    <term><tag class="attribute">in</tag> and / or <tag
                                                  class="attribute">out</tag> and an implicit
                                             fileset</term>
                                    <listitem>
                                             <para>The implicit fileset is ignored (and, when the
                                                  log level is <literal>verbose</literal>, a message
                                                  is emitted)</para>
                                    </listitem>
                           </varlistentry>
                           <varlistentry>
                                    <term>Two or more of <tag class="attribute">out</tag>, a
                                             resource for <tag class="attribute">outPort</tag>, a
                                             mapper for <tag class="attribute">outPort</tag>, and
                                                  <tag class="attribute">extension</tag></term>
                                    <listitem>
                                             <para>Too conflicted</para>
                                    </listitem>
                           </varlistentry>
                           <varlistentry>
                                    <term>Duplicate parameter QNames for the same port or duplicate
                                             option QNames</term>
                                    <listitem>
                                             <para>Too conflicted</para>
                                    </listitem>
                           </varlistentry>
                           <varlistentry>
                                    <term>Pipeline input port with no explicit binding (or more than
                                             one when one <tag class="element">calabash</tag> input
                                             port is unnamed)</term>
                                    <listitem>
                                             <para>No input is applied to the port.</para>
                                             <para>When one <tag class="element">calabash</tag> port
                                                  is unnamed and more than one pipeline input port
                                                  has no explicit binding, one of the unbound
                                                  pipeline ports is mapped to the unnamed port, but
                                                  you can't control which pipeline port.</para>
                                    </listitem>
                           </varlistentry>
                           <varlistentry>
                                    <term>Pipeline output port with no explicit binding (or more
                                             than one when one <tag class="element">calabash</tag>
                                             output port is unnamed)</term>
                                    <listitem>
                                             <para>The pipeline output on that port is
                                                  discarded</para>
                                             <para>When one <tag class="element">calabash</tag>
                                                  output port is unnamed and more than one pipeline
                                                  output port has no explicit binding, one of the
                                                  unbound pipeline ports is mapped to the unnamed
                                                  port, but you can't control which pipeline
                                                  port.</para>
                                    </listitem>
                           </varlistentry><varlistentry>
                                    <term>Resources and mapper on same port</term>
                                    <listitem>
                                             <para>Too conflicted</para>
                                    </listitem>
                           </varlistentry>
                           <varlistentry>
                                    <term>Multiple mappers for one port</term>
                                    <listitem>
                                             <para>Too conflicted</para>
                                    </listitem>
                           </varlistentry>
                           <varlistentry>
                                    <term>Mapper on main input port</term>
                                    <listitem>
                                             <para>The file(s) on the main input port, determined by
                                                      the <tag class="attribute">inPort</tag> value,
                                                      provides the name that other mappers use as their
                                                      basis. A mapper on the main input port has nothing
                                                      to use as a basis, so it's not allowed.</para>
                                    </listitem>
                           </varlistentry>
                           <varlistentry>
                                    <term>Multiple specifications for an output port or output port
                                             resource collections or mappers that resolve to more
                                             than one filename</term>
                                    <listitem>
                                             <para>The outputs of a pipeline run are each directed
                                                      to at most one file</para>
                                    </listitem>
                           </varlistentry>
                           <varlistentry>
                                    <term><tag class="element">namespace</tag> without <tag
                                             class="attribute">prefix</tag> or without <tag
                                                      class="attribute">uri</tag></term>
                                    <listitem>
                                             <para><tag class="element">namespace</tag> is for
                                                  mapping prefixes to URIs</para>
                                    </listitem>
                           </varlistentry>

                  </variablelist>
         </section>
</chapter>
